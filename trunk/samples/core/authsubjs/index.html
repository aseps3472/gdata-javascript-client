<html>
<head>
    <title>Example: AuthSubJS with JQuery</title>
    <link rel="stylesheet" type="text/css" href="main.css" />
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">

      // Load the Google Data JS Client for Blogger.
      google.load('gdata', '2.x', {packages: ['blogger']});

      // Load JQuery
      google.load('jquery', '1.3.2');

      /**
       * Fades from one div to another, and calls the opt_callback method once
       * the fade is done (if opt_callback exists).
       * @param {Object} fromdiv The div to fade out.
       * @param {Object} todiv The div to fade in.
       * @param {Function} opt_callback Optional method to call once the fade is
       *     done.
       */
      function transitionDiv(fromdiv, todiv, opt_callback) {
        $('#' + fromdiv).fadeOut('fast', function() {
          $('#' + todiv).fadeIn('fast', function() {
            if (opt_callback) {
              opt_callback();
            }
          });
        });
      }

      /**
       * Shows the "loading" div and logs the user out of the application.
       * Reloads the page after the user has logged out.
       */
      function logout() {
        transitionDiv('divLoggedIn', 'divLoggingIn', function() {
          google.accounts.user.logout(function() {
            window.location.reload();
          });
        });
      }

      /**
       * Shows the "loading" div and then prompts the user to log in.
       */
      function login() {
        var scope = 'http://www.blogger.com/feeds';
        transitionDiv('divLoggedOut', 'divLoggingIn', function() {
          google.accounts.user.login(scope);
        });
      }

      /**
       * Error handler that gets called if there was an error loading the feed.
       * The error message is displayed on the page.
       */
      function errorHandler(response) {
        document.getElementById('divContent').innerHTML =
            'ERROR: ' + response.message;
        transitionDiv('divContentLoading', 'divContent');
      }

      /**
       * Displays the response from loadData() on the page.
       */
      function loadDataHandler(response) {
        var fragment = document.createDocumentFragment();
        var heading = document.createElement('h3');
        var title = response.feed.getTitle().getText();
        heading.appendChild(document.createTextNode(title));
        fragment.appendChild(heading);
        var ul = document.createElement('ul');
        var entries = response.feed.getEntries();
        for (var i = 0; i < entries.length; i++) {
          var entry = entries[i];
          var entryTitle = entry.getTitle().getText();
          var li = document.createElement('li');
          li.appendChild(document.createTextNode(entryTitle));
          ul.appendChild(li);
        }
        fragment.appendChild(ul);
        document.getElementById('divContent').appendChild(fragment);
        transitionDiv('divContentLoading', 'divContent');
      }

      /**
       * Loads a feed from Blogger.
       */
      function loadData() {
        var service = new google.gdata.blogger.BloggerService('AuthSubJS Sample');
        var feedUrl = 'http://www.blogger.com/feeds/default/blogs';
        service.getBlogFeed(feedUrl, loadDataHandler, errorHandler);
      }

      // This method checks the status of the user, and diplays the appropriate
      // content area.
      google.setOnLoadCallback(function() {
        var status = google.accounts.user.getStatus();
        if (status == google.accounts.AuthSubStatus.LOGGING_IN) {
          // User is in the process of logging in, do nothing.
          return;
        } else if (status == google.accounts.AuthSubStatus.LOGGED_OUT) {
          // User is logged out, display the "login" link.
          transitionDiv('divLoggingIn', 'divLoggedOut');
        } else {
          // User is logged in, load the user's data.
          transitionDiv('divLoggingIn', 'divLoggedIn', loadData);
        }
      });

    </script>
  </head>
  <body>

    <h2>Example: AuthSubJS with JQuery</h2>
    <div id="container">
    <div id="divLoggingIn">
      <img src="loading.gif" height="32" width="32" />
    </div>
    <div id="divLoggedOut" style="display: none;">
      <a href="#" onclick="login(); return false;">login</a>
    </div>
    <div id="divLoggedIn" style="display: none;">
      <a href="#" onclick="logout(); return false;">logout</a><br /><br />
      <div id="divContentLoading">
        <img src="loading.gif" height="32" width="32" />
      </div>
      <div id="divContent" style="display: none; text-align: left;">
      </div>
    </div>
    </div>

  </body>
</html>
